name: Build Gradle project

on:
    push:

jobs:
    build-gradle-project:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout project sources
              uses: actions/checkout@v3

            - name: Setup Gradle
              uses: gradle/gradle-build-action@v2

            - name: Run build with Gradle Wrapper
              run: ./gradlew build

            - name: Generate report
              run: ./gradlew runner:analyzePlugins

            - name: Convert Markdown to HTML
              uses: jaywcjlove/markdown-to-html-cli@v3.7.0
              with:
                source: runner/build/plugin-analysis/aggregate-report.md
                output: pages/plugin-analysis.html

            - name: Upload GitHub pages
              uses: actions/upload-pages-artifact@v2
              with:
                  path: pages

            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v2
